<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Pro - Escuela N¬∞ 711 Federico Brandsen</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset y Variables de Tema */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark: #1e293b;
            --light: #f8fafc;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Modo Oscuro */
        body.dark-mode {
            --dark: #f8fafc;
            --light: #1e293b;
            --shadow: 0 10px 30px rgba(255,255,255,0.1);
        }

        /* Estilos Globales */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
            color: var(--dark);
            min-height: 100vh;
            transition: var(--transition);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--gradient);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .school-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* Toggle Tema */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--primary);
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Formularios */
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
        }

        .dark-mode .section {
            background: #1e293b;
        }

        .section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Radio Buttons Personalizados */
        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            flex: 1;
            min-width: 150px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 12px;
            background: #f1f5f9;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .radio-option input[type="radio"]:checked + label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* Botones */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(99, 102, 241, 0.6);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        /* Resultados */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .card {
            background: #1e293b;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--accent, var(--primary));
        }

        .card h3 {
            color: var(--accent, var(--primary));
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dark);
            margin: 10px 0;
        }

        .metric-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }

        .status-ok { background: #d1fae5; color: #065f46; }
        .status-warning { background: #fed7aa; color: #92400e; }
        .status-danger { background: #fee2e2; color: #991b1b; }

        /* Gr√°ficos */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
        }

        /* Recomendaciones */
        .recommendations {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .dark-mode .recommendations {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
        }

        .recommendation-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid var(--success);
        }

        .dark-mode .recommendation-item {
            background: #1e293b;
        }

        /* Enfermedades */
        .disease-card {
            background: #fff1f2;
            border-left-color: var(--danger);
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
        }

        .dark-mode .disease-card {
            background: #450a0a;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            background: var(--gradient);
            color: white;
            border-radius: 15px;
            margin-top: 50px;
        }

        .student-names {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .student-tag {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .form-grid { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr; }
            .school-logo { position: static; margin-top: 15px; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <span id="theme-icon">üåô</span>
    </button>

    <div class="container">
        <!-- Header -->
        <header class="header fade-in">
            <div class="school-logo">
                üéì EP N¬∞ 711 "F. Brandsen"
            </div>
            <h1>üåü Health Tracker Pro</h1>
            <p>Tu Salud en tus Manos - Sistema de Monitoreo Integral</p>
        </header>

        <!-- Formulario de Datos Personales -->
        <section class="section fade-in">
            <h2>üë§ Datos Personales</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre">Nombre Completo</label>
                    <input type="text" id="nombre" placeholder="Ej: Mar√≠a Gonz√°lez">
                </div>
                <div class="form-group">
                    <label for="edad">Edad (a√±os)</label>
                    <input type="number" id="edad" min="5" max="120" placeholder="Ej: 16">
                </div>
                <div class="form-group">
                    <label for="peso">Peso (kg)</label>
                    <input type="number" id="peso" min="1" max="300" step="0.1" placeholder="Ej: 65.5">
                </div>
                <div class="form-group">
                    <label for="estatura">Estatura (cm)</label>
                    <input type="number" id="estatura" min="50" max="250" placeholder="Ej: 170">
                </div>
                <div class="form-group">
                    <label>G√©nero</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="masculino" name="genero" value="M">
                            <label for="masculino">‚ôÇÔ∏è Masculino</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="femenino" name="genero" value="F">
                            <label for="femenino">‚ôÄÔ∏è Femenino</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="actividad">Nivel de Actividad F√≠sica</label>
                    <select id="actividad">
                        <option value="">Seleccione...</option>
                        <option value="1.2">Sedentario (poco o ning√∫n ejercicio)</option>
                        <option value="1.375">Ligero (ejercicio 1-3 d√≠as/semana)</option>
                        <option value="1.55">Moderado (ejercicio 3-5 d√≠as/semana)</option>
                        <option value="1.725">Activo (ejercicio 6-7 d√≠as/semana)</option>
                        <option value="1.9">Muy activo (ejercicio muy fuerte diario)</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Tracker de H√°bitos -->
        <section class="section fade-in">
            <h2>üìä H√°bitos de Salud</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="hidratacion">Hidrataci√≥n Diaria (vasos de agua, 250ml)</label>
                    <input type="number" id="hidratacion" min="0" max="20" placeholder="Ej: 8">
                    <div class="progress-bar">
                        <div class="progress-fill" id="hidratacion-bar" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ejercicio">Minutos de Ejercicio por Semana</label>
                    <input type="number" id="ejercicio" min="0" max="1000" placeholder="Ej: 150">
                    <div class="progress-bar">
                        <div class="progress-fill" id="ejercicio-bar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="comidas">Comidas Saludables al D√≠a (0-5)</label>
                    <input type="number" id="comidas" min="0" max="5" placeholder="Ej: 3">
                    <small>Incluye frutas, verduras, prote√≠nas magras, granos integrales</small>
                </div>

                <div class="form-group">
                    <label for="sueno">Horas de Sue√±o por Noche</label>
                    <input type="number" id="sueno" min="0" max="24" step="0.5" placeholder="Ej: 8">
                    <div class="progress-bar">
                        <div class="progress-fill" id="sueno-bar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="pantallas">Horas frente a Pantallas por D√≠a</label>
                    <input type="number" id="pantallas" min="0" max="24" step="0.5" placeholder="Ej: 6">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pantallas-bar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="chatarra">Comida "Chatarra" por Semana (porciones)</label>
                    <input type="number" id="chatarra" min="0" max="50" placeholder="Ej: 3">
                    <div class="progress-bar">
                        <div class="progress-fill" id="chatarra-bar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bebidas">Bebidas Artificiales por Semana (vasos)</label>
                    <input type="number" id="bebidas" min="0" max="50" placeholder="Ej: 5">
                    <div class="progress-bar">
                        <div class="progress-fill" id="bebidas-bar" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="calcularTodo()">
                üöÄ Calcular y Generar An√°lisis
            </button>
        </section>

        <!-- Resultados -->
        <section id="resultados" class="fade-in" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 30px;">üìà Resultados de tu Salud</h2>
            
            <div class="results-grid">
                <!-- IMC -->
                <div class="card" style="--accent: var(--info);">
                    <h3>üèãÔ∏è √çndice de Masa Corporal (IMC)</h3>
                    <div class="metric-value" id="imc-valor">--</div>
                    <p id="imc-categoria">--</p>
                    <div class="metric-status" id="imc-status">--</div>
                </div>

                <!-- TMB -->
                <div class="card" style="--accent: var(--success);">
                    <h3>üî• Tasa Metab√≥lica Basal (TMB)</h3>
                    <div class="metric-value" id="tmb-valor">-- kcal/d√≠a</div>
                    <p>Gasto energ√©tico en reposo</p>
                    <div id="tmb-total" style="margin-top: 10px; font-weight: bold;"></div>
                </div>

                <!-- Score de Salud -->
                <div class="card" style="--accent: var(--warning);">
                    <h3>‚≠ê Score de Salud General</h3>
                    <div class="metric-value" id="health-score">--/100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="score-bar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Edad Metab√≥lica -->
                <div class="card" style="--accent: var(--primary);">
                    <h3>üß¨ Edad Metab√≥lica</h3>
                    <div class="metric-value" id="edad-metabolica">-- a√±os</div>
                    <p id="edad-comparacion"></p>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="section" style="margin-top: 30px;">
                <h2>üìä An√°lisis Visual</h2>
                <div class="form-grid">
                    <div style="grid-column: span 2;">
                        <h3>Distribuci√≥n de H√°bitos Saludables</h3>
                        <div class="chart-container">
                            <canvas id="habitsChart"></canvas>
                        </div>
                    </div>
                    <div style="grid-column: span 2;">
                        <h3>Riesgos de Salud por H√°bitos</h3>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recomendaciones Personalizadas -->
            <div class="recommendations fade-in">
                <h2>üí° Recomendaciones Personalizadas</h2>
                <div id="lista-recomendaciones"></div>
            </div>

            <!-- Enfermedades Relacionadas -->
            <div class="section fade-in">
                <h2>‚ö†Ô∏è Riesgos de Enfermedades por H√°bitos</h2>
                <div id="lista-enfermedades"></div>
            </div>

            <!-- Bot√≥n Exportar -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="exportarDatos()">
                    üìÑ Generar Reporte PDF
                </button>
                <button class="btn btn-warning" onclick="reiniciar()">
                    üîÑ Nuevo An√°lisis
                </button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer fade-in">
            <p>üéì Desarrollado por estudiantes de la Escuela Provincial N¬∞ 711 "Federico Brandsen"</p>
            <p>üìç Comodoro Rivadavia - Chubut - Argentina</p>
            <div class="student-names">
                <span class="student-tag">üë©‚Äçüíª Alumno 1</span>
                <span class="student-tag">üë®‚Äçüíª Alumno 2</span>
                <span class="student-tag">üë©‚Äçüíª Alumno 3</span>
                <span class="student-tag">üë®‚Äçüíª Alumno 4</span>
            </div>
            <p style="margin-top: 15px;">‚è∞ 2025 - Muestra Anual de Ciencias de la Salud</p>
        </footer>
    </div>

    <script>
        // Variables Globales
        let habitsChart, riskChart;
        const datosUsuario = {};

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para actualizar barras en tiempo real
            ['hidratacion', 'ejercicio', 'sueno', 'pantallas', 'chatarra', 'bebidas'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    actualizarBarra(id);
                });
            });
        });

        // Cambiar tema oscuro/claro
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('theme-icon');
            icon.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        }

        // Actualizar barras de progreso
        function actualizarBarra(tipo) {
            const valor = parseFloat(document.getElementById(tipo).value) || 0;
            const barra = document.getElementById(`${tipo}-bar`);
            
            let porcentaje = 0;
            let recomendado = '';
            
            switch(tipo) {
                case 'hidratacion':
                    porcentaje = Math.min((valor / 8) * 100, 100);
                    recomendado = '8 vasos recomendados';
                    break;
                case 'ejercicio':
                    porcentaje = Math.min((valor / 150) * 100, 100);
                    recomendado = '150 min/semana recomendados';
                    break;
                case 'sueno':
                    porcentaje = Math.min((valor / 8) * 100, 100);
                    recomendado = '8 horas recomendadas';
                    break;
                case 'pantallas':
                    porcentaje = Math.min((valor / 12) * 100, 100);
                    recomendado = '>4 hrs es preocupante';
                    break;
                case 'chatarra':
                    porcentaje = Math.min((valor / 7) * 100, 100);
                    recomendado = '<3 porciones/semana ideal';
                    break;
                case 'bebidas':
                    porcentaje = Math.min((valor / 7) * 100, 100);
                    recomendado = '<5 vasos/semana ideal';
                    break;
            }
            
            barra.style.width = `${porcentaje}%`;
            barra.textContent = `${Math.round(porcentaje)}% - ${recomendado}`;
        }

        // C√°lculos principales
        function calcularTodo() {
            // Validar datos
            if (!validarFormulario()) return;

            // Obtener datos
            const nombre = document.getElementById('nombre').value;
            const edad = parseInt(document.getElementById('edad').value);
            const peso = parseFloat(document.getElementById('peso').value);
            const estatura = parseFloat(document.getElementById('estatura').value) / 100;
            const genero = document.querySelector('input[name="genero"]:checked')?.value;
            const actividad = parseFloat(document.getElementById('actividad').value);

            if (!nombre || !edad || !peso || !estatura || !genero || !actividad) {
                alert('‚ö†Ô∏è Por favor, completa todos los campos obligatorios.');
                return;
            }

            // Calcular IMC
            const imc = peso / (estatura * estatura);
            const categoriaIMC = obtenerCategoriaIMC(imc);
            
            // Calcular TMB (F√≥rmula de Harris-Benedict)
            let tmb;
            if (genero === 'M') {
                tmb = 88.362 + (13.397 * peso) + (4.799 * estatura * 100) - (5.677 * edad);
            } else {
                tmb = 447.593 + (9.247 * peso) + (3.098 * estatura * 100) - (4.330 * edad);
            }
            const tmbTotal = tmb * actividad;

            // Obtener h√°bitos
            const habitos = {
                hidratacion: parseInt(document.getElementById('hidratacion').value) || 0,
                ejercicio: parseInt(document.getElementById('ejercicio').value) || 0,
                comidas: parseInt(document.getElementById('comidas').value) || 0,
                sueno: parseFloat(document.getElementById('sueno').value) || 0,
                pantallas: parseFloat(document.getElementById('pantallas').value) || 0,
                chatarra: parseInt(document.getElementById('chatarra').value) || 0,
                bebidas: parseInt(document.getElementById('bebidas').value) || 0
            };

            // Calcular score de salud
            const score = calcularHealthScore(imc, habitos);

            // Calcular edad metab√≥lica
            const edadMetabolica = calcularEdadMetabolica(edad, habitos, imc);

            // Mostrar resultados
            mostrarResultados(imc, categoriaIMC, tmb, tmbTotal, score, edadMetabolica, edad);
            
            // Generar gr√°ficos
            generarGraficos(habitos, score);
            
            // Generar recomendaciones
            generarRecomendaciones(imc, categoriaIMC, habitos, edad);
            
            // Generar enfermedades
            generarAnalisisEnfermedades(habitos, imc);

            // Mostrar secci√≥n
            document.getElementById('resultados').style.display = 'block';
            document.getElementById('resultados').scrollIntoView({ behavior: 'smooth' });
        }

        function validarFormulario() {
            const campos = ['nombre', 'edad', 'peso', 'estatura'];
            let valid = true;
            
            campos.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (!elemento.value) {
                    elemento.style.borderColor = 'var(--danger)';
                    valid = false;
                } else {
                    elemento.style.borderColor = '#e2e8f0';
                }
            });

            if (!document.querySelector('input[name="genero"]:checked')) {
                alert('‚ö†Ô∏è Por favor, selecciona tu g√©nero.');
                valid = false;
            }

            if (!document.getElementById('actividad').value) {
                alert('‚ö†Ô∏è Por favor, selecciona tu nivel de actividad.');
                valid = false;
            }

            return valid;
        }

        function obtenerCategoriaIMC(imc) {
            if (imc < 18.5) return { categoria: 'Bajo peso', color: 'status-warning', riesgo: 'Moderado' };
            if (imc < 25) return { categoria: 'Peso normal', color: 'status-ok', riesgo: 'Bajo' };
            if (imc < 30) return { categoria: 'Sobrepeso', color: 'status-warning', riesgo: 'Moderado' };
            if (imc < 35) return { categoria: 'Obesidad I', color: 'status-danger', riesgo: 'Alto' };
            return { categoria: 'Obesidad II', color: 'status-danger', riesgo: 'Muy Alto' };
        }

        function calcularHealthScore(imc, habitos) {
            let score = 50; // Base
            
            // IMC score
            if (imc >= 18.5 && imc < 25) score += 20;
            else if (imc >= 25 && imc < 30) score += 5;
            else if (imc >= 30) score -= 10;
            else score += 10;

            // H√°bitos saludables
            score += Math.min(habitos.hidratacion * 2, 16); // M√°x 16 pts
            score += Math.min(habitos.ejercicio / 10, 15); // M√°x 15 pts
            score += habitos.comidas * 5; // M√°x 25 pts
            score += Math.min(habitos.sueno * 3, 24); // M√°x 24 pts
            
            // Penalizaciones
            score -= Math.min(habitos.pantallas * 2, 20); // M√°x -20
            score -= Math.min(habitos.chatarra * 1.5, 15); // M√°x -15
            score -= Math.min(habitos.bebidas * 1, 10); // M√°x -10

            return Math.max(0, Math.min(100, Math.round(score)));
        }

        function calcularEdadMetabolica(edad, habitos, imc) {
            let factor = 0;
            
            // H√°bitos que envejecen o rejuvenecen
            if (habitos.sueno >= 7 && habitos.sueno <= 9) factor -= 2;
            else if (habitos.sueno < 6) factor += 3;
            
            if (habitos.ejercicio >= 150) factor -= 3;
            else if (habitos.ejercicio < 60) factor += 2;
            
            if (imc >= 18.5 && imc < 25) factor -= 1;
            else if (imc >= 30) factor += 4;
            
            if (habitos.hidratacion >= 8) factor -= 1;
            
            return Math.max(5, Math.round(edad + factor));
        }

        function mostrarResultados(imc, categoriaIMC, tmb, tmbTotal, score, edadMetabolica, edadReal) {
            // IMC
            document.getElementById('imc-valor').textContent = imc.toFixed(1);
            document.getElementById('imc-categoria').textContent = categoriaIMC.categoria;
            const imcStatus = document.getElementById('imc-status');
            imcStatus.textContent = `Riesgo: ${categoriaIMC.riesgo}`;
            imcStatus.className = `metric-status ${categoriaIMC.color}`;

            // TMB
            document.getElementById('tmb-valor').textContent = `${Math.round(tmb)} kcal/d√≠a`;
            document.getElementById('tmb-total').textContent = `Gasto total: ${Math.round(tmbTotal)} kcal/d√≠a`;

            // Score
            document.getElementById('health-score').textContent = `${score}/100`;
            document.getElementById('score-bar').style.width = `${score}%`;

            // Edad metab√≥lica
            document.getElementById('edad-metabolica').textContent = `${edadMetabolica} a√±os`;
            const diff = edadMetabolica - edadReal;
            const comp = diff > 0 ? `‚ö†Ô∏è ${diff} a√±os mayor que tu edad real` : 
                         diff < 0 ? `‚úÖ ${Math.abs(diff)} a√±os menor que tu edad real` : 
                         '‚úÖ Igual a tu edad real';
            document.getElementById('edad-comparacion').innerHTML = `<strong>${comp}</strong>`;
        }

        function generarGraficos(habitos, score) {
            // Destruir gr√°ficos previos
            if (habitsChart) habitsChart.destroy();
            if (riskChart) riskChart.destroy();

            // Gr√°fico de H√°bitos
            const ctx1 = document.getElementById('habitsChart').getContext('2d');
            habitsChart = new Chart(ctx1, {
                type: 'radar',
                data: {
                    labels: ['üíß Hidrataci√≥n', 'üèÉ Ejercicio', 'ü•ó Comidas', 'üò¥ Sue√±o', 'üì± Pantallas', 'üçü Chatarra', 'ü•§ Bebidas'],
                    datasets: [{
                        label: 'Tus H√°bitos',
                        data: [
                            Math.min(habitos.hidratacion * 12.5, 100),
                            Math.min(habitos.ejercicio / 1.5, 100),
                            habitos.comidas * 20,
                            Math.min(habitos.sueno * 12.5, 100),
                            Math.min(habitos.pantallas * 8.33, 100),
                            Math.min(habitos.chatarra * 14.28, 100),
                            Math.min(habitos.bebidas * 14.28, 100)
                        ],
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)'
                    }, {
                        label: 'Ideal',
                        data: [100, 100, 100, 100, 50, 30, 30],
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderColor: 'rgba(16, 185, 129, 0.5)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--dark').trim()
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Riesgos
            const ctx2 = document.getElementById('riskChart').getContext('2d');
            const riesgos = calcularRiesgos(habitos);
            
            riskChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['‚ù§Ô∏è Enfermedades Card√≠acas', 'üß† Problemas Mentales', 'ü´Å Respiratorias', 'ü©∏ Diabetes', 'ü¶¥ M√∫sculo-Esquel√©ticas'],
                    datasets: [{
                        data: [riesgos.cardiaco, riesgos.mental, riesgos.respiratorio, riesgos.diabetes, riesgos.musculo],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--dark').trim()
                            }
                        }
                    }
                }
            });
        }

        function calcularRiesgos(habitos) {
            return {
                cardiaco: Math.min((habitos.chatarra * 3 + habitos.bebidas * 2 + (habitos.pantallas > 4 ? 15 : 0) + (habitos.ejercicio < 60 ? 20 : 0)), 100),
                mental: Math.min((habitos.pantallas > 6 ? 30 : 0) + (habitos.sueno < 6 ? 25 : 0) + (habitos.ejercicio < 90 ? 15 : 0) + (habitos.comidas < 2 ? 20 : 0), 100),
                respiratorio: Math.min((habitos.chatarra > 5 ? 20 : 0) + (habitos.ejercicio < 30 ? 30 : 0) + (habitos.pantallas > 8 ? 15 : 0), 100),
                diabetes: Math.min((habitos.bebidas * 4 + habitos.chatarra * 3 + (habitos.comidas < 2 ? 25 : 0) + (habitos.ejercicio < 60 ? 20 : 0)), 100),
                musculo: Math.min((habitos.ejercicio < 60 ? 30 : 0) + (habitos.sueno < 6 ? 20 : 0) + (habitos.chatarra > 3 ? 15 : 0), 100)
            };
        }

        function generarRecomendaciones(imc, categoriaIMC, habitos, edad) {
            const recomendaciones = [];

            // IMC
            if (imc < 18.5) {
                recomendaciones.push({
                    icon: 'üçñ',
                    titulo: 'Aumentar peso saludablemente',
                    texto: 'Consume m√°s prote√≠nas magras, frutos secos y granos integrales. Aumenta 300-500 kcal diarias.',
                    prioridad: 'Alta'
                });
            } else if (imc >= 25) {
                recomendaciones.push({
                    icon: 'üèÉ',
                    titulo: 'Programa de p√©rdida de peso',
                    texto: 'Reduce 500 kcal diarias y aumenta ejercicio a 300 min/semana. Evita alimentos procesados.',
                    prioridad: 'Alta'
                });
            }

            // Hidrataci√≥n
            if (habitos.hidratacion < 6) {
                recomendaciones.push({
                    icon: 'üíß',
                    titulo: 'Mejora tu hidrataci√≥n',
                    texto: 'Bebe al menos 8 vasos de agua al d√≠a. Lleva una botella siempre contigo.',
                    prioridad: 'Alta'
                });
            }

            // Ejercicio
            if (habitos.ejercicio < 150) {
                recomendaciones.push({
                    icon: 'üèÉ',
                    titulo: 'Aumenta actividad f√≠sica',
                    texto: 'Objetivo: 150 min/semana. Empieza con 20 min diarios de caminata r√°pida.',
                    prioridad: 'Media'
                });
            }

            // Sue√±o
            if (habitos.sueno < 7) {
                recomendaciones.push({
                    icon: 'üò¥',
                    titulo: 'Mejora tu higiene del sue√±o',
                    texto: 'Duerme 7-9 horas. Evita pantallas 1h antes de dormir. Mant√©n horario regular.',
                    prioridad: 'Alta'
                });
            }

            // Pantallas
            if (habitos.pantallas > 6) {
                recomendaciones.push({
                    icon: 'üì±',
                    titulo: 'Reduce tiempo de pantallas',
                    texto: 'L√≠mite: 4 horas/d√≠a. Usa la regla 20-20-20 (cada 20min, mira 20 pies por 20s).',
                    prioridad: 'Media'
                });
            }

            // Comida chatarra
            if (habitos.chatarra > 3) {
                recomendaciones.push({
                    icon: 'ü•ó',
                    titulo: 'Reduce comida ultraprocesada',
                    texto: 'M√°ximo 3 porciones/semana. Reemplaza con frutas, verduras y frutos secos.',
                    prioridad: 'Media'
                });
            }

            // Bebidas
            if (habitos.bebidas > 5) {
                recomendaciones.push({
                    icon: 'üçµ',
                    titulo: 'Evita bebidas azucaradas',
                    texto: 'M√°ximo 5 vasos/semana. Mejora con agua, t√© o infusiones naturales.',
                    prioridad: 'Alta'
                });
            }

            // Mostrar recomendaciones
            const container = document.getElementById('lista-recomendaciones');
            container.innerHTML = recomendaciones.map(rec => `
                <div class="recommendation-item">
                    <h4>${rec.icon} ${rec.titulo} <span style="color: var(--${rec.prioridad === 'Alta' ? 'danger' : 'warning'});">[${rec.prioridad}]</span></h4>
                    <p>${rec.texto}</p>
                </div>
            `).join('');
        }

        function generarAnalisisEnfermedades(habitos, imc) {
            const enfermedades = [];

            // Diabetes
            if (habitos.bebidas > 7 || habitos.chatarra > 5) {
                enfermedades.push({
                    nombre: 'Diabetes Mellitus Tipo 2',
                    descripcion: 'Enfermedad cr√≥nica donde el cuerpo no utiliza correctamente la insulina.',
                    causa: 'Alta ingesta de az√∫cares, bebidas artificiales y comida chatarra.',
                    prevencion: 'Reduce az√∫cares en un 80%, aumenta fibra y ejercicio 150min/semana.',
                    gravedad: 'Alto'
                });
            }

            // Cardiovasculares
            if (imc >= 30 || habitos.chatarra > 5 || habitos.ejercicio < 60) {
                enfermedades.push({
                    nombre: 'Enfermedades Cardiovasculares',
                    descripcion: 'Incluye hipertensi√≥n, infartos y problemas circulatorios.',
                    causa: 'Obesidad, dieta alta en grasas trans, sedentarismo.',
                    prevencion: 'IMC <25, ejercicio 150min/semana, dieta mediterr√°nea.',
                    gravedad: 'Muy Alto'
                });
            }

            // Mentales
            if (habitos.pantallas > 8 || habitos.sueno < 6) {
                enfermedades.push({
                    nombre: 'Trastornos de Ansiedad/Depresi√≥n',
                    descripcion: 'Afectan tu estado de √°nimo y calidad de vida.',
                    causa: 'Sobrecarga digital, falta de sue√±o, falta de actividad f√≠sica.',
                    prevencion: 'L√≠mite pantallas 4hrs/d√≠a, 8hrs sue√±o, ejercicio 30min diarios.',
                    gravedad: 'Alto'
                });
            }

            // Respiratorias
            if (habitos.ejercicio < 30 || habitos.pantallas > 8) {
                enfermedades.push({
                    nombre: 'Problemas Respiratorios',
                    descripcion: 'Disminuci√≥n de capacidad pulmonar y resistencia.',
                    causa: 'Sedentarismo, mala postura, falta de actividad aer√≥bica.',
                    prevencion: 'Ejercicio cardio 90min/semana, estiramientos, buena postura.',
                    gravedad: 'Moderado'
                });
            }

            // Musculoesquel√©ticas
            if (habitos.ejercicio < 60 || habitos.sueno < 6) {
                enfermedades.push({
                    nombre: 'Problemas M√∫sculo-Esquel√©ticos',
                    descripcion: 'Dolores de espalda, cervicales, articulaciones.',
                    causa: 'Falta de fortalecimiento muscular, mala postura, descanso insuficiente.',
                    prevencion: 'Ejercicio de fuerza 2-3x/semana, 8hrs sue√±o, ergonom√≠a.',
                    gravedad: 'Moderado'
                });
            }

            // Mostrar
            const container = document.getElementById('lista-enfermedades');
            container.innerHTML = enfermedades.map(enf => `
                <div class="disease-card">
                    <h3>‚ö†Ô∏è ${enf.nombre} <span style="color: var(--${enf.gravedad === 'Muy Alto' ? 'danger' : enf.gravedad === 'Alto' ? 'warning' : 'info'});">[Riesgo: ${enf.gravedad}]</span></h3>
                    <p><strong>¬øQu√© es?:</strong> ${enf.descripcion}</p>
                    <p><strong>Causas en tu caso:</strong> ${enf.causa}</p>
                    <p><strong>üõ°Ô∏è Prevenci√≥n:</strong> ${enf.prevencion}</p>
                </div>
            `).join('');
        }

        function exportarDatos() {
            alert('üìÑ Reporte generado (simulaci√≥n).\n\nEn una implementaci√≥n real, esto generar√≠a un PDF profesional con:\n- Todos tus datos\n- Gr√°ficos\n- Recomendaciones\n- Plan de acci√≥n personalizado\n\nOpciones:\n1. Imprimir esta p√°gina (Ctrl+P)\n2. Guardar como PDF\n3. Enviar por email');
        }

        function reiniciar() {
            if (confirm('¬øDeseas realizar un nuevo an√°lisis?')) {
                location.reload();
            }
        }
    </script>
</body>
</html>